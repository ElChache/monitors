{"version":3,"file":"_server.ts-yURdbXKo.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/api/monitors/drafts/save/_server.ts.js"],"sourcesContent":["import { error, json } from \"@sveltejs/kit\";\nimport { J as JWTService } from \"../../../../../../chunks/jwt.js\";\nimport { db } from \"../../../../../../chunks/connection.js\";\nimport { a as monitorDrafts } from \"../../../../../../chunks/users.js\";\nimport { eq } from \"drizzle-orm\";\nconst POST = async ({ request, cookies }) => {\n  try {\n    const accessToken = cookies.get(\"access_token\");\n    if (!accessToken) {\n      throw error(401, \"Authentication required\");\n    }\n    const payload = JWTService.verifyAccessToken(accessToken);\n    const userId = payload.userId;\n    const body = await request.json();\n    const { prompt, name, monitorType, extractedFact, triggerCondition, factType, aiSuggestions } = body;\n    if (!prompt || typeof prompt !== \"string\") {\n      throw error(400, \"Prompt is required\");\n    }\n    if (prompt.length > 500) {\n      throw error(400, \"Prompt must be 500 characters or less\");\n    }\n    const existingDraft = await db.select().from(monitorDrafts).where(eq(monitorDrafts.userId, userId)).limit(1);\n    const draftData = {\n      userId,\n      prompt: prompt.trim(),\n      name: name?.trim() || null,\n      monitorType: monitorType || null,\n      extractedFact: extractedFact || null,\n      triggerCondition: triggerCondition || null,\n      factType: factType || null,\n      aiSuggestions: aiSuggestions ? JSON.stringify(aiSuggestions) : null,\n      updatedAt: /* @__PURE__ */ new Date()\n    };\n    let draft;\n    if (existingDraft.length > 0) {\n      [draft] = await db.update(monitorDrafts).set(draftData).where(eq(monitorDrafts.id, existingDraft[0].id)).returning();\n    } else {\n      [draft] = await db.insert(monitorDrafts).values({\n        ...draftData,\n        createdAt: /* @__PURE__ */ new Date()\n      }).returning();\n    }\n    return json({\n      success: true,\n      message: \"Draft saved successfully\",\n      draft: {\n        id: draft.id,\n        prompt: draft.prompt,\n        name: draft.name,\n        monitorType: draft.monitorType,\n        extractedFact: draft.extractedFact,\n        triggerCondition: draft.triggerCondition,\n        factType: draft.factType,\n        aiSuggestions: draft.aiSuggestions ? JSON.parse(draft.aiSuggestions) : null,\n        updatedAt: draft.updatedAt\n      }\n    });\n  } catch (err) {\n    console.error(\"Draft save endpoint error:\", err);\n    if (err?.status) {\n      throw err;\n    }\n    return json(\n      {\n        success: false,\n        error: \"Failed to save draft\"\n      },\n      { status: 500 }\n    );\n  }\n};\nexport {\n  POST\n};\n"],"names":[],"mappings":"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"}