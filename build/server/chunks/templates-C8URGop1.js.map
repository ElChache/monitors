{"version":3,"file":"templates-C8URGop1.js","sources":["../../../.svelte-kit/adapter-node/chunks/templates.js"],"sourcesContent":["import { d as db } from \"./db.js\";\nimport { c as emailNotifications, d as emailUnsubscribes } from \"./users.js\";\nimport { and, eq } from \"drizzle-orm\";\nconst EMAIL_TEMPLATES = {\n  MONITOR_NOTIFICATION: {\n    name: \"monitor_notification\",\n    subject: \"ðŸš¨ Monitor Alert: {{monitorName}}\",\n    htmlTemplate: `\n      <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;\">\n        <div style=\"background: #ef4444; color: white; padding: 20px; text-align: center;\">\n          <h1>ðŸš¨ Monitor Alert</h1>\n          <h2>{{monitorName}}</h2>\n        </div>\n        <div style=\"background: #f9fafb; padding: 20px;\">\n          <p>Hi {{userName}},</p>\n          <p>Your monitor \"<strong>{{monitorName}}</strong>\" has been triggered!</p>\n          <div style=\"background: white; padding: 15px; border-left: 4px solid #ef4444;\">\n            <h3>Trigger Details</h3>\n            <p><strong>Condition:</strong> {{triggerCondition}}</p>\n            <p><strong>Current Value:</strong> {{currentValue}}</p>\n            {{#if previousValue}}<p><strong>Previous Value:</strong> {{previousValue}}</p>{{/if}}\n          </div>\n          <p style=\"text-align: center; margin: 20px 0;\">\n            <a href=\"{{monitorUrl}}\" style=\"background: #3b82f6; color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px; margin: 0 5px;\">View Monitor</a>\n            <a href=\"{{dashboardUrl}}\" style=\"background: #3b82f6; color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px; margin: 0 5px;\">Dashboard</a>\n          </p>\n        </div>\n        <div style=\"background: #374151; color: white; padding: 20px; text-align: center;\">\n          <p>Â© 2024 Monitors!</p>\n          <p style=\"font-size: 12px;\"><a href=\"{{unsubscribeUrl}}\" style=\"color: #9ca3af;\">Unsubscribe</a></p>\n        </div>\n      </div>\n    `,\n    textTemplate: `\n      MONITOR ALERT: {{monitorName}}\n      \n      Hi {{userName}},\n      \n      Your monitor \"{{monitorName}}\" has been triggered!\n      \n      Trigger Details:\n      - Condition: {{triggerCondition}}\n      - Current Value: {{currentValue}}\n      {{#if previousValue}}- Previous Value: {{previousValue}}{{/if}}\n      \n      View Monitor: {{monitorUrl}}\n      Dashboard: {{dashboardUrl}}\n      \n      Unsubscribe: {{unsubscribeUrl}}\n      \n      Â© 2024 Monitors!\n    `,\n    description: \"Email sent when a monitor trigger condition is met\"\n  },\n  USER_VERIFICATION: {\n    name: \"user_verification\",\n    subject: \"Verify your Monitors! account\",\n    htmlTemplate: `\n      <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;\">\n        <div style=\"background: #3b82f6; color: white; padding: 20px; text-align: center;\">\n          <h1>Welcome to Monitors!</h1>\n        </div>\n        <div style=\"background: #f9fafb; padding: 20px;\">\n          <p>Hi {{userName}},</p>\n          <p>Thank you for signing up! Please verify your email address:</p>\n          <p style=\"text-align: center; margin: 30px 0;\">\n            <a href=\"{{verificationUrl}}\" style=\"background: #10b981; color: white; padding: 15px 30px; text-decoration: none; border-radius: 6px;\">Verify Email</a>\n          </p>\n          <p>This link expires in {{expirationHours}} hours.</p>\n          <p style=\"font-size: 14px; color: #6b7280;\">{{verificationUrl}}</p>\n        </div>\n        <div style=\"background: #374151; color: white; padding: 20px; text-align: center;\">\n          <p>Â© 2024 Monitors!</p>\n        </div>\n      </div>\n    `,\n    textTemplate: `\n      Welcome to Monitors!\n      \n      Hi {{userName}},\n      \n      Thank you for signing up! Please verify your email address:\n      \n      {{verificationUrl}}\n      \n      This link expires in {{expirationHours}} hours.\n      \n      Â© 2024 Monitors!\n    `,\n    description: \"Email sent to new users for email verification\"\n  },\n  PASSWORD_RESET: {\n    name: \"password_reset\",\n    subject: \"Reset your Monitors! password\",\n    htmlTemplate: `\n      <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;\">\n        <div style=\"background: #f59e0b; color: white; padding: 20px; text-align: center;\">\n          <h1>Password Reset</h1>\n        </div>\n        <div style=\"background: #f9fafb; padding: 20px;\">\n          <p>Hi {{userName}},</p>\n          <p>We received a request to reset your password:</p>\n          <p style=\"text-align: center; margin: 30px 0;\">\n            <a href=\"{{resetUrl}}\" style=\"background: #ef4444; color: white; padding: 15px 30px; text-decoration: none; border-radius: 6px;\">Reset Password</a>\n          </p>\n          <p>This link expires in {{expirationHours}} hours.</p>\n          <p>If you didn't request this, you can safely ignore this email.</p>\n          <p style=\"font-size: 14px; color: #6b7280;\">{{resetUrl}}</p>\n        </div>\n        <div style=\"background: #374151; color: white; padding: 20px; text-align: center;\">\n          <p>Â© 2024 Monitors!</p>\n        </div>\n      </div>\n    `,\n    textTemplate: `\n      Password Reset Request\n      \n      Hi {{userName}},\n      \n      We received a request to reset your password:\n      \n      {{resetUrl}}\n      \n      This link expires in {{expirationHours}} hours.\n      \n      If you didn't request this, you can safely ignore this email.\n      \n      Â© 2024 Monitors!\n    `,\n    description: \"Email sent when user requests password reset\"\n  }\n};\nclass EmailTemplateRenderer {\n  /**\n   * Simple handlebars-style template rendering\n   */\n  static render(template, data) {\n    let rendered = template;\n    Object.keys(data).forEach((key) => {\n      const regex = new RegExp(`{{${key}}}`, \"g\");\n      rendered = rendered.replace(regex, String(data[key] || \"\"));\n    });\n    rendered = rendered.replace(/{{#if\\s+(\\w+)}}(.*?){{\\/if}}/gs, (match, variable, content) => {\n      return data[variable] ? content : \"\";\n    });\n    return rendered;\n  }\n  /**\n   * Render email template with data\n   */\n  static renderTemplate(templateName, data) {\n    const template = EMAIL_TEMPLATES[templateName];\n    if (!template) {\n      throw new Error(`Email template '${templateName}' not found`);\n    }\n    return {\n      subject: this.render(template.subject, data),\n      html: this.render(template.htmlTemplate, data),\n      text: this.render(template.textTemplate, data)\n    };\n  }\n}\nclass EmailTrackingService {\n  /**\n   * Log email delivery attempt\n   */\n  static async logDelivery(userId, email, type, subject, result) {\n    try {\n      await db.insert(emailNotifications).values({\n        userId,\n        email,\n        type,\n        subject,\n        status: result.success ? \"sent\" : \"failed\",\n        messageId: result.messageId,\n        errorMessage: result.error,\n        sentAt: result.success ? /* @__PURE__ */ new Date() : null,\n        createdAt: /* @__PURE__ */ new Date()\n      });\n    } catch (error) {\n      console.error(\"Failed to log email delivery:\", error);\n    }\n  }\n  /**\n   * Check if user is unsubscribed from a specific notification type\n   */\n  static async isUnsubscribed(userId, notificationType) {\n    try {\n      const unsubscribe = await db.select().from(emailUnsubscribes).where(and(\n        eq(emailUnsubscribes.userId, userId),\n        eq(emailUnsubscribes.notificationType, notificationType)\n      )).limit(1);\n      return unsubscribe.length > 0;\n    } catch (error) {\n      console.error(\"Failed to check unsubscribe status:\", error);\n      return false;\n    }\n  }\n  /**\n   * Unsubscribe user from specific notification type\n   */\n  static async unsubscribe(userId, notificationType) {\n    try {\n      await db.insert(emailUnsubscribes).values({\n        userId,\n        notificationType,\n        unsubscribedAt: /* @__PURE__ */ new Date()\n      }).onConflictDoNothing();\n      return true;\n    } catch (error) {\n      console.error(\"Failed to unsubscribe user:\", error);\n      return false;\n    }\n  }\n  /**\n   * Get email delivery statistics for a user\n   */\n  static async getDeliveryStats(userId) {\n    try {\n      const notifications = await db.select().from(emailNotifications).where(eq(emailNotifications.userId, userId)).orderBy(emailNotifications.createdAt).limit(10);\n      const total = notifications.length;\n      const sent = notifications.filter((n) => n.status === \"sent\").length;\n      const failed = notifications.filter((n) => n.status === \"failed\").length;\n      return {\n        total,\n        sent,\n        failed,\n        recent: notifications\n      };\n    } catch (error) {\n      console.error(\"Failed to get delivery stats:\", error);\n      return { total: 0, sent: 0, failed: 0, recent: [] };\n    }\n  }\n  /**\n   * Generate unsubscribe URL\n   */\n  static generateUnsubscribeUrl(userId, notificationType) {\n    const baseUrl = process.env.APP_URL || \"https://monitors.app\";\n    const token = Buffer.from(`${userId}:${notificationType}`).toString(\"base64\");\n    return `${baseUrl}/unsubscribe?token=${token}`;\n  }\n  /**\n   * Parse unsubscribe token\n   */\n  static parseUnsubscribeToken(token) {\n    try {\n      const decoded = Buffer.from(token, \"base64\").toString(\"utf-8\");\n      const [userId, notificationType] = decoded.split(\":\");\n      if (!userId || !notificationType) {\n        return null;\n      }\n      return { userId, notificationType };\n    } catch (error) {\n      console.error(\"Failed to parse unsubscribe token:\", error);\n      return null;\n    }\n  }\n}\nexport {\n  EmailTemplateRenderer as E,\n  EmailTrackingService as a\n};\n"],"names":[],"mappings":";;;;AAGA,MAAM,eAAe,GAAG;AACxB,EAAE,oBAAoB,EAAE;AACxB,IAAI,IAAI,EAAE,sBAAsB;AAChC,IAAI,OAAO,EAAE,mCAAmC;AAChD,IAAI,YAAY,EAAE;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI,CAAC;AACL,IAAI,YAAY,EAAE;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI,CAAC;AACL,IAAI,WAAW,EAAE;AACjB,GAAG;AACH,EAAE,iBAAiB,EAAE;AACrB,IAAI,IAAI,EAAE,mBAAmB;AAC7B,IAAI,OAAO,EAAE,+BAA+B;AAC5C,IAAI,YAAY,EAAE;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI,CAAC;AACL,IAAI,YAAY,EAAE;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI,CAAC;AACL,IAAI,WAAW,EAAE;AACjB,GAAG;AACH,EAAE,cAAc,EAAE;AAClB,IAAI,IAAI,EAAE,gBAAgB;AAC1B,IAAI,OAAO,EAAE,+BAA+B;AAC5C,IAAI,YAAY,EAAE;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI,CAAC;AACL,IAAI,YAAY,EAAE;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI,CAAC;AACL,IAAI,WAAW,EAAE;AACjB;AACA,CAAC;AACD,MAAM,qBAAqB,CAAC;AAC5B;AACA;AACA;AACA,EAAE,OAAO,MAAM,CAAC,QAAQ,EAAE,IAAI,EAAE;AAChC,IAAI,IAAI,QAAQ,GAAG,QAAQ;AAC3B,IAAI,M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"}