{"version":3,"file":"db-DnzjOtfS.js","sources":["../../../.svelte-kit/adapter-node/chunks/db.js"],"sourcesContent":["import pg from \"pg\";\nimport { config } from \"dotenv\";\nconfig();\nconst { Pool } = pg;\nconst pool = new Pool({\n  host: process.env.DATABASE_HOST || \"localhost\",\n  port: parseInt(process.env.DATABASE_PORT || \"5432\"),\n  database: process.env.DATABASE_NAME || \"monitors\",\n  user: process.env.DATABASE_USER || \"postgres\",\n  password: process.env.DATABASE_PASSWORD || \"postgres\",\n  max: 20,\n  idleTimeoutMillis: 3e4,\n  connectionTimeoutMillis: 2e3\n});\npool.on(\"error\", (err) => {\n  console.error(\"Unexpected database pool error:\", err);\n});\nconst db = {\n  query: (text, params) => {\n    return pool.query(text, params);\n  },\n  getClient: async () => {\n    return await pool.connect();\n  },\n  transaction: async (callback) => {\n    const client = await pool.connect();\n    try {\n      await client.query(\"BEGIN\");\n      const result = await callback(client);\n      await client.query(\"COMMIT\");\n      return result;\n    } catch (error) {\n      await client.query(\"ROLLBACK\");\n      throw error;\n    } finally {\n      client.release();\n    }\n  },\n  end: async () => {\n    await pool.end();\n  }\n};\nexport {\n  db as d\n};\n"],"names":[],"mappings":";;;AAEA,MAAM,EAAE;AACR,MAAM,EAAE,IAAI,EAAE,GAAG,EAAE;AACnB,MAAM,IAAI,GAAG,IAAI,IAAI,CAAC;AACtB,EAAE,IAAI,EAAE,OAAO,CAAC,GAAG,CAAC,aAAa,IAAI,WAAW;AAChD,EAAE,IAAI,EAAE,QAAQ,CAAC,OAAO,CAAC,GAAG,CAAC,aAAa,IAAI,MAAM,CAAC;AACrD,EAAE,QAAQ,EAAE,OAAO,CAAC,GAAG,CAAC,aAAa,IAAI,UAAU;AACnD,EAAE,IAAI,EAAE,OAAO,CAAC,GAAG,CAAC,aAAa,IAAI,UAAU;AAC/C,EAAE,QAAQ,EAAE,OAAO,CAAC,GAAG,CAAC,iBAAiB,IAAI,UAAU;AACvD,EAAE,GAAG,EAAE,EAAE;AACT,EAAE,iBAAiB,EAAE,GAAG;AACxB,EAAE,uBAAuB,EAAE;AAC3B,CAAC,CAAC;AACF,IAAI,CAAC,EAAE,CAAC,OAAO,EAAE,CAAC,GAAG,KAAK;AAC1B,EAAE,OAAO,CAAC,KAAK,CAAC,iCAAiC,EAAE,GAAG,CAAC;AACvD,CAAC,CAAC;AACG,MAAC,EAAE,GAAG;AACX,EAAE,KAAK,EAAE,CAAC,IAAI,EAAE,MAAM,KAAK;AAC3B,IAAI,OAAO,IAAI,CAAC,KAAK,CAAC,IAAI,EAAE,MAAM,CAAC;AACnC,EAAE,CAAC;AACH,EAAE,SAAS,EAAE,YAAY;AACzB,IAAI,OAAO,MAAM,IAAI,CAAC,OAAO,EAAE;AAC/B,EAAE,CAAC;AACH,EAAE,WAAW,EAAE,OAAO,QAAQ,KAAK;AACnC,IAAI,MAAM,MAAM,GAAG,MAAM,IAAI,CAAC,OAAO,EAAE;AACvC,IAAI,IAAI;AACR,MAAM,MAAM,MAAM,CAAC,KAAK,CAAC,OAAO,CAAC;AACjC,MAAM,MAAM,MAAM,GAAG,MAAM,QAAQ,CAAC,MAAM,CAAC;AAC3C,MAAM,MAAM,MAAM,CAAC,KAAK,CAAC,QAAQ,CAAC;AAClC,MAAM,OAAO,MAAM;AACnB,IAAI,CAAC,CAAC,OAAO,KAAK,EAAE;AACpB,MAAM,MAAM,MAAM,CAAC,KAAK,CAAC,UAAU,CAAC;AACpC,MAAM,MAAM,KAAK;AACjB,IAAI,CAAC,SAAS;AACd,MAAM,MAAM,CAAC,OAAO,EAAE;AACtB,IAAI;AACJ,EAAE,CAAC;AACH,EAAE,GAAG,EAAE,YAAY;AACnB,IAAI,MAAM,IAAI,CAAC,GAAG,EAAE;AACpB,EAAE;AACF;;;;"}