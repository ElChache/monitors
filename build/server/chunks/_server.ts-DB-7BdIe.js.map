{"version":3,"file":"_server.ts-DB-7BdIe.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/api/cache/stats/_server.ts.js"],"sourcesContent":["import { error, json } from \"@sveltejs/kit\";\nimport { C as CacheService, a as CacheTrackingService } from \"../../../../../chunks/service3.js\";\nconst GET = async ({ url }) => {\n  try {\n    if (process.env.NODE_ENV === \"production\" && process.env.CACHE_STATS_ENABLED !== \"true\") {\n      throw error(403, \"Cache statistics are not available in production\");\n    }\n    const type = url.searchParams.get(\"type\");\n    const detailed = url.searchParams.get(\"detailed\") === \"true\";\n    const cacheStats = await CacheService.getCacheStats();\n    const healthCheck = await CacheService.healthCheck();\n    let result = {\n      timestamp: (/* @__PURE__ */ new Date()).toISOString(),\n      redis: healthCheck.redis,\n      caches: healthCheck.caches,\n      stats: cacheStats\n    };\n    if (detailed) {\n      const analytics = await CacheTrackingService.getCacheAnalytics();\n      result.analytics = analytics;\n      if (type) {\n        const topKeys = await CacheTrackingService.getTopCacheKeys(\n          type,\n          10\n        );\n        result.topKeys = topKeys;\n      }\n    }\n    return json(result);\n  } catch (err) {\n    console.error(\"Cache stats error:\", err);\n    if (err && typeof err === \"object\" && \"status\" in err) {\n      throw err;\n    }\n    throw error(500, \"Failed to retrieve cache statistics\");\n  }\n};\nconst POST = async ({ request }) => {\n  try {\n    if (process.env.NODE_ENV !== \"development\") {\n      throw error(403, \"Cache statistics clearing is only available in development\");\n    }\n    const body = await request.json();\n    const { action } = body;\n    if (action === \"cleanup\") {\n      const days = body.days || 7;\n      const cleaned = await CacheTrackingService.cleanupOldEvents(days);\n      return json({\n        success: true,\n        message: `Cleaned up cache events older than ${days} days`,\n        eventsRemoved: cleaned\n      });\n    }\n    throw error(400, \"Unknown action\");\n  } catch (err) {\n    console.error(\"Cache stats POST error:\", err);\n    if (err && typeof err === \"object\" && \"status\" in err) {\n      throw err;\n    }\n    throw error(500, \"Failed to process cache statistics request\");\n  }\n};\nexport {\n  GET,\n  POST\n};\n"],"names":[],"mappings":"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"}