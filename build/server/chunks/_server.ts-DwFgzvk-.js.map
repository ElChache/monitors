{"version":3,"file":"_server.ts-DwFgzvk-.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/api/monitoring/status/_server.ts.js"],"sourcesContent":["import { json } from \"@sveltejs/kit\";\nimport { J as JWTService } from \"../../../../../chunks/jwt.js\";\nimport \"../../../../../chunks/db.js\";\nimport \"../../../../../chunks/users.js\";\nimport { W as WebScraperService } from \"../../../../../chunks/evaluation_service.js\";\nimport \"../../../../../chunks/service4.js\";\nimport { M as MonitorJobQueue } from \"../../../../../chunks/job_queue_simple.js\";\nimport \"../../../../../chunks/connection.js\";\nconst GET = async ({ cookies }) => {\n  try {\n    const sessionToken = cookies.get(\"session\");\n    if (!sessionToken) {\n      return json({ error: \"Not authenticated\" }, { status: 401 });\n    }\n    const payload = JWTService.verifyAccessToken(sessionToken);\n    if (!payload.userId) {\n      return json({ error: \"Invalid session\" }, { status: 401 });\n    }\n    const [queueHealth, scraperHealth, queueStats] = await Promise.all([\n      MonitorJobQueue.healthCheck(),\n      WebScraperService.healthCheck(),\n      MonitorJobQueue.getQueueStats()\n    ]);\n    const systemStatus = {\n      overall: \"healthy\",\n      components: {\n        jobQueue: {\n          status: queueHealth.connected ? \"healthy\" : \"unhealthy\",\n          connected: queueHealth.connected,\n          error: queueHealth.error\n        },\n        webScraper: {\n          status: scraperHealth.canScrape ? \"healthy\" : \"unhealthy\",\n          browserReady: scraperHealth.browserReady,\n          canScrape: scraperHealth.canScrape,\n          version: scraperHealth.version\n        },\n        queue: {\n          waiting: queueStats.waiting,\n          active: queueStats.active,\n          completed: queueStats.completed,\n          failed: queueStats.failed,\n          delayed: queueStats.delayed\n        }\n      },\n      timestamp: (/* @__PURE__ */ new Date()).toISOString()\n    };\n    if (!queueHealth.connected || !scraperHealth.canScrape) {\n      systemStatus.overall = \"degraded\";\n    }\n    return json({\n      success: true,\n      data: systemStatus\n    });\n  } catch (error) {\n    console.error(\"Monitoring status endpoint error:\", error);\n    if (error.message?.includes(\"expired\")) {\n      return json({ error: \"Session expired\" }, { status: 401 });\n    }\n    return json(\n      {\n        error: \"Internal server error\",\n        data: {\n          overall: \"unhealthy\",\n          components: {},\n          timestamp: (/* @__PURE__ */ new Date()).toISOString()\n        }\n      },\n      { status: 500 }\n    );\n  }\n};\nexport {\n  GET\n};\n"],"names":[],"mappings":"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"}