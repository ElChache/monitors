{"version":3,"file":"_server.ts-BcqeAll1.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/api/monitors/_server.ts.js"],"sourcesContent":["import { error, json } from \"@sveltejs/kit\";\nimport { z } from \"zod\";\nimport { l as listMonitorsSchema, M as MonitorService, c as createMonitorSchema } from \"../../../../chunks/service3.js\";\nimport { J as JWTService } from \"../../../../chunks/jwt.js\";\nconst GET = async ({ request, cookies, url }) => {\n  try {\n    const sessionToken = cookies.get(\"session\");\n    if (!sessionToken) {\n      throw error(401, \"Authentication required\");\n    }\n    const payload = JWTService.verifyAccessToken(sessionToken);\n    if (!payload) {\n      throw error(401, \"Invalid session token\");\n    }\n    const queryParams = Object.fromEntries(url.searchParams);\n    const query = listMonitorsSchema.parse(queryParams);\n    const result = await MonitorService.getMonitors(payload.userId, query);\n    return json({\n      success: true,\n      data: result\n    });\n  } catch (err) {\n    console.error(\"Get monitors error:\", err);\n    if (err instanceof z.ZodError) {\n      throw error(400, {\n        message: \"Invalid query parameters\",\n        details: err.errors\n      });\n    }\n    if (err && typeof err === \"object\" && \"status\" in err) {\n      throw err;\n    }\n    throw error(500, \"Failed to retrieve monitors\");\n  }\n};\nconst POST = async ({ request, cookies }) => {\n  try {\n    const sessionToken = cookies.get(\"session\");\n    if (!sessionToken) {\n      throw error(401, \"Authentication required\");\n    }\n    const payload = JWTService.verifyAccessToken(sessionToken);\n    if (!payload) {\n      throw error(401, \"Invalid session token\");\n    }\n    const data = await request.json();\n    const validatedData = createMonitorSchema.parse(data);\n    const currentCount = await MonitorService.getUserMonitorCount(payload.userId);\n    if (currentCount >= 50) {\n      throw error(429, {\n        message: \"Monitor limit reached\",\n        details: \"Maximum of 50 monitors allowed per user\"\n      });\n    }\n    const monitor = await MonitorService.createMonitor(payload.userId, validatedData);\n    return json({\n      success: true,\n      message: \"Monitor created successfully\",\n      data: monitor\n    }, { status: 201 });\n  } catch (err) {\n    console.error(\"Create monitor error:\", err);\n    if (err instanceof z.ZodError) {\n      throw error(400, {\n        message: \"Invalid monitor data\",\n        details: err.errors\n      });\n    }\n    if (err && typeof err === \"object\" && \"status\" in err) {\n      throw err;\n    }\n    throw error(500, \"Failed to create monitor\");\n  }\n};\nexport {\n  GET,\n  POST\n};\n"],"names":[],"mappings":"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"}